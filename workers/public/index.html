<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Entry Dashboard</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
				line-height: 1.6;
			}
			h1, h2 {
				color: #333;
			}
			.container {
				display: flex;
				gap: 30px;
				flex-wrap: wrap;
			}
			.section {
				flex: 1;
				min-width: 300px;
			}
			.entry-form {
				background-color: #f5f5f5;
				padding: 20px;
				border-radius: 5px;
				margin-bottom: 20px;
			}
			.form-group {
				margin-bottom: 15px;
			}
			label {
				display: block;
				margin-bottom: 5px;
				font-weight: bold;
			}
			input {
				width: 100%;
				padding: 8px;
				box-sizing: border-box;
				border: 1px solid #ddd;
				border-radius: 4px;
			}
			button {
				background-color: #4CAF50;
				color: white;
				padding: 10px 15px;
				border: none;
				border-radius: 4px;
				cursor: pointer;
			}
			button:hover {
				background-color: #45a049;
			}
			table {
				width: 100%;
				border-collapse: collapse;
				margin-top: 20px;
			}
			th, td {
				padding: 12px;
				text-align: left;
				border-bottom: 1px solid #ddd;
			}
			th {
				background-color: #f2f2f2;
			}
			.error {
				color: red;
				margin-top: 10px;
			}
			.success {
				color: green;
				margin-top: 10px;
			}
		</style>
	</head>
	<body>
		<h1>Entry Dashboard</h1>
		
		<div class="container">
			<div class="section">
				<h2>Add New Entry</h2>
				<div class="entry-form">
					<form id="entryForm">
						<div class="form-group">
							<label for="entryType">Entry Type:</label>
							<input type="text" id="entryType" name="entry_type" required>
						</div>
						<div class="form-group">
							<label for="price">Price:</label>
							<input type="number" id="price" name="price" step="0.01" min="0" required>
						</div>
						<button type="submit">Submit Entry</button>
					</form>
					<div id="formMessage"></div>
				</div>
			</div>
			
			<div class="section">
				<h2>Entry Summary</h2>
				<div id="summarySectionContent">
					<p>Loading summary data...</p>
				</div>
			</div>
		</div>

		<script>
			// Function to load and display summary data
			function loadSummary() {
				fetch('/api/summary')
					.then(response => {
						if (!response.ok) {
							throw new Error('Failed to fetch summary data');
						}
						return response.json();
					})
					.then(data => {
						const summarySection = document.getElementById('summarySectionContent');
						
						if (data && data.length > 0) {
							// Create a table to display summary data
							let tableHtml = `
								<table>
									<thead>
										<tr>
											<th>Entry Type</th>
											<th>Count</th>
											<th>Total Value</th>
											<th>Average Price</th>
										</tr>
									</thead>
									<tbody>
							`;
							
							data.forEach(item => {
								tableHtml += `
									<tr>
										<td>${item.entry_type}</td>
										<td>${item.count}</td>
										<td>$${item.total_value.toFixed(2)}</td>
										<td>$${item.average_price.toFixed(2)}</td>
									</tr>
								`;
							});
							
							tableHtml += `
									</tbody>
								</table>
							`;
							
							summarySection.innerHTML = tableHtml;
						} else {
							summarySection.innerHTML = '<p>No entries found. Add some entries to see the summary.</p>';
						}
					})
					.catch(error => {
						console.error('Error loading summary:', error);
						document.getElementById('summarySectionContent').innerHTML = 
							`<p class="error">Error loading summary data: ${error.message}</p>`;
					});
			}

			// Function to handle form submission
			document.getElementById('entryForm').addEventListener('submit', function(e) {
				e.preventDefault();
				
				const entryType = document.getElementById('entryType').value;
				const price = parseFloat(document.getElementById('price').value);
				
				// Create the payload to send
				const payload = {
					entry_type: entryType,
					price: price
				};
				
				// Send data to the server
				fetch('/api/log-entry', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(payload)
				})
				.then(response => {
					if (!response.ok) {
						throw new Error('Failed to submit entry');
					}
					return response.json();
				})
				.then(data => {
					// Show success message
					document.getElementById('formMessage').innerHTML = 
						'<p class="success">Entry added successfully!</p>';
					
					// Clear the form
					document.getElementById('entryForm').reset();
					
					// Reload the summary to show updated data
					loadSummary();
				})
				.catch(error => {
					console.error('Error submitting entry:', error);
					document.getElementById('formMessage').innerHTML = 
						`<p class="error">Error submitting entry: ${error.message}</p>`;
				});
			});

			// Load summary data when the page loads
			document.addEventListener('DOMContentLoaded', loadSummary);
		</script>
	</body>
</html>
